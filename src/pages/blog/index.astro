---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

const allPosts = await getCollection('blog');
const publishedPosts = allPosts
  .filter(post => !post.data.draft)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<Layout title="Blog - El Cerillazo">
  <div class="mx-auto max-w-6xl px-4 py-12">
    <header class="text-center mb-12">
      <h1 class="text-4xl md:text-5xl font-bold space-text-gradient mb-4">Blog</h1>
      <p class="text-xl text-gray-600 dark:text-gray-400">{publishedPosts.length} posts publicados</p>
    </header>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      {publishedPosts.map(post => (
        <article class="glass rounded-xl p-6 hover-lift">
          {post.data.image && (
            <img 
              src={post.data.image} 
              alt={post.data.title}
              class="w-full h-48 object-cover rounded-lg mb-4"
              loading="lazy"
            />
          )}
          <h2 class="text-xl md:text-2xl font-semibold mb-3">
            <a href={'/blog/' + post.slug} class="hover:text-blue-500 dark:hover:text-blue-400 transition-colors">
              {post.data.title}
            </a>
          </h2>
          <time class="text-sm text-gray-500 dark:text-gray-400 mb-3 block">
            {post.data.pubDate.toLocaleDateString('es-ES', {
              year: 'numeric',
              month: 'long',
              day: 'numeric'
            })}
          </time>
          {post.data.description && (
            <p class="text-gray-600 dark:text-gray-300 mb-4">
              {post.data.description}
            </p>
          )}
          {post.data.categories && (
            <div class="flex flex-wrap gap-2">
              {post.data.categories.map(category => (
                <span class="bg-blue-500/20 text-blue-700 dark:text-blue-300 px-3 py-1 rounded-full text-xs">
                  {category}
                </span>
              ))}
            </div>
          )}
        </article>
      ))}
    </div>
  </div>
</Layout>